{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nexport let UploadPostComponent = class UploadPostComponent {\n  constructor(route, router, profileService, friendsService, privacyService) {\n    this.route = route;\n    this.router = router;\n    this.profileService = profileService;\n    this.friendsService = friendsService;\n    this.privacyService = privacyService;\n    this.mediaPreview = null;\n    this.description = '';\n    this.privacy = 'PUBLIC';\n    this.postId = null;\n    this.isEdit = false;\n    this.selectedFile = null;\n    this.friends = [];\n    this.isCustomPrivacy = false;\n    this.currentUserId = Number(localStorage.getItem('userId')) || 1;\n  }\n  ngOnInit() {\n    this.postId = Number(this.route.snapshot.paramMap.get('id'));\n    this.isEdit = !!this.postId;\n    if (this.isEdit && this.postId) {\n      this.profileService.getPostById(this.postId).subscribe({\n        next: post => {\n          this.description = post.content;\n          this.privacy = post.privacy;\n          this.mediaPreview = post.mediaUrl || null;\n        },\n        error: err => {\n          console.error('Error loading post', err);\n        }\n      });\n    }\n  }\n  onMediaSelected(event) {\n    const file = event.target.files[0];\n    if (file) {\n      this.selectedFile = file;\n      const reader = new FileReader();\n      reader.onload = () => {\n        this.mediaPreview = reader.result;\n      };\n      reader.readAsDataURL(file);\n    }\n  }\n  isImage(file) {\n    return typeof file === 'string' && file.includes('/uploads') || typeof file === 'string' && file.startsWith('data:image');\n  }\n  isVideo(file) {\n    return typeof file === 'string' && file.includes('/uploads') || typeof file === 'string' && file.startsWith('data:video');\n  }\n  savePost() {\n    if (!this.description.trim() && !this.selectedFile) {\n      alert('Post cannot be empty');\n      return;\n    }\n    const formData = new FormData();\n    formData.append('content', this.description);\n    formData.append('privacy', this.privacy);\n    if (this.selectedFile) {\n      formData.append('file', this.selectedFile);\n    }\n    if (this.isEdit && this.postId) {\n      // update post\n      this.profileService.updatePost(this.postId, formData).subscribe({\n        next: () => {\n          alert('Post updated successfully');\n          if (this.isCustomPrivacy) this.saveCustomPrivacy(this.postId);\n          this.router.navigate(['/profile']);\n        },\n        error: err => {\n          console.error('Error updating post', err);\n          alert('Failed to update post');\n        }\n      });\n    } else {\n      // create new post\n      this.profileService.createPost(this.currentUserId, formData).subscribe({\n        next: data => {\n          alert('Post created successfully');\n          if (this.isCustomPrivacy) this.saveCustomPrivacy(data.postId);\n          this.router.navigate(['/profile']);\n        },\n        error: err => {\n          console.error('Error creating post', err);\n          alert('Failed to create post');\n        }\n      });\n    }\n  }\n  cancelPost() {\n    this.router.navigate(['/profile']);\n  }\n  loadRequests() {\n    this.friendsService.getFriends(localStorage.getItem('userId')).subscribe({\n      next: data => {\n        this.friends = data.map(x => {\n          x.selected = false;\n          return x;\n        });\n      },\n      error: err => console.error('Error loading received requests', err)\n    });\n  }\n  check(friendId) {\n    this.friends[friendId].selected = !this.friends[friendId].selected;\n  }\n  onPrivacyChange(event) {\n    this.isCustomPrivacy = this.privacy === \"CUSTOM\";\n  }\n  saveCustomPrivacy(postId) {\n    const selectedFriends = this.friends.filter(f => f.selected);\n    selectedFriends.forEach(friend => this.privacyService.addRule(postId, friend.userId, \"CUSTOM\").subscribe({\n      next: data => console.log(data),\n      error: err => console.log(\"Error:\", err)\n    }));\n  }\n};\nUploadPostComponent = __decorate([Component({\n  selector: 'app-upload-post',\n  templateUrl: './upload-post.component.html',\n  styleUrls: ['./upload-post.component.css']\n})], UploadPostComponent);","map":{"version":3,"names":["Component","UploadPostComponent","constructor","route","router","profileService","friendsService","privacyService","mediaPreview","description","privacy","postId","isEdit","selectedFile","friends","isCustomPrivacy","currentUserId","Number","localStorage","getItem","ngOnInit","snapshot","paramMap","get","getPostById","subscribe","next","post","content","mediaUrl","error","err","console","onMediaSelected","event","file","target","files","reader","FileReader","onload","result","readAsDataURL","isImage","includes","startsWith","isVideo","savePost","trim","alert","formData","FormData","append","updatePost","saveCustomPrivacy","navigate","createPost","data","cancelPost","loadRequests","getFriends","map","x","selected","check","friendId","onPrivacyChange","selectedFriends","filter","f","forEach","friend","addRule","userId","log","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\ayushman.jha01\\Saved Games\\Facebook_group3\\group3-frontend\\src\\app\\features\\profile\\upload-post\\upload-post.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { FriendsService, UserDTO } from 'src/app/core/services/Friends/friends.service';\r\nimport { PrivacyService } from 'src/app/core/services/Privacy/privacy.service';\r\nimport { ProfileService } from 'src/app/main/services/profile.service';\r\n\r\n@Component({\r\n  selector: 'app-upload-post',\r\n  templateUrl: './upload-post.component.html',\r\n  styleUrls: ['./upload-post.component.css']\r\n})\r\nexport class UploadPostComponent implements OnInit {\r\n  mediaPreview: string | ArrayBuffer | null = null;\r\n  description: string = '';\r\n  privacy: string = 'PUBLIC';\r\n  postId: number | null = null;   \r\n  isEdit: boolean = false;\r\n  currentUserId: number;\r\n  selectedFile: File | null = null;  \r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private profileService: ProfileService,\r\n    private friendsService:FriendsService,\r\n    private privacyService:PrivacyService\r\n  ) {\r\n    this.currentUserId = Number(localStorage.getItem('userId')) || 1;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.postId = Number(this.route.snapshot.paramMap.get('id'));\r\n    this.isEdit = !!this.postId;\r\n\r\n    if (this.isEdit && this.postId) {\r\n      this.profileService.getPostById(this.postId).subscribe({\r\n        next: (post) => {\r\n          this.description = post.content;\r\n          this.privacy = post.privacy;\r\n          this.mediaPreview = post.mediaUrl || null;\r\n        },\r\n        error: (err) => {\r\n          console.error('Error loading post', err);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  onMediaSelected(event: any) {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      this.selectedFile = file; \r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        this.mediaPreview = reader.result;\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  isImage(file: any) {\r\n    return typeof file === 'string' && file.includes('/uploads') || (typeof file === 'string' && file.startsWith('data:image'));\r\n  }\r\n\r\n  isVideo(file: any) {\r\n    return typeof file === 'string' && file.includes('/uploads') || (typeof file === 'string' && file.startsWith('data:video'));\r\n  }\r\n\r\n  savePost() {\r\n    if (!this.description.trim() && !this.selectedFile) {\r\n      alert('Post cannot be empty');\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('content', this.description);\r\n    formData.append('privacy', this.privacy);\r\n\r\n    if (this.selectedFile) {\r\n      formData.append('file', this.selectedFile);\r\n    }\r\n\r\n    if (this.isEdit && this.postId) {\r\n      // update post\r\n      this.profileService.updatePost(this.postId, formData).subscribe({\r\n        next: () => {\r\n          alert('Post updated successfully');\r\n          if(this.isCustomPrivacy) this.saveCustomPrivacy(this.postId);\r\n          this.router.navigate(['/profile']);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error updating post', err);\r\n          alert('Failed to update post');\r\n        }\r\n      });\r\n    } else {\r\n      // create new post\r\n      this.profileService.createPost(this.currentUserId, formData).subscribe({\r\n        next: data => {\r\n          alert('Post created successfully');\r\n          if(this.isCustomPrivacy) this.saveCustomPrivacy(data.postId);\r\n          this.router.navigate(['/profile']);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error creating post', err);\r\n          alert('Failed to create post');\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  cancelPost() {\r\n    this.router.navigate(['/profile']);\r\n  }\r\n\r\n  loadRequests(): void {\r\n    this.friendsService.getFriends(localStorage.getItem('userId')).subscribe({\r\n      next: data => {\r\n        this.friends=data.map(x=>{x.selected=false; return x;});\r\n      },\r\n      error: err => console.error('Error loading received requests', err)\r\n    });\r\n  }\r\n  friends:UserDTO[]=[];\r\n\r\n  check(friendId:any):void{\r\n    this.friends[friendId].selected=!this.friends[friendId].selected;\r\n  }\r\n\r\n  isCustomPrivacy:boolean=false;\r\n  onPrivacyChange(event:any){\r\n    this.isCustomPrivacy=this.privacy===\"CUSTOM\";\r\n  }\r\n\r\n  saveCustomPrivacy(postId:number|null):void{\r\n    const selectedFriends=this.friends.filter(f=>f.selected);\r\n    selectedFriends.forEach(friend=> this.privacyService.addRule(postId,friend.userId,\"CUSTOM\").subscribe({\r\n      next: data=>console.log(data),\r\n      error: err=>console.log(\"Error:\",err)\r\n      }));\r\n  }\r\n\r\n}"],"mappings":";AAAA,SAASA,SAAS,QAAgB,eAAe;AAW1C,WAAMC,mBAAmB,GAAzB,MAAMA,mBAAmB;EAS9BC,YACUC,KAAqB,EACrBC,MAAc,EACdC,cAA8B,EAC9BC,cAA6B,EAC7BC,cAA6B;IAJ7B,KAAAJ,KAAK,GAALA,KAAK;IACL,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,cAAc,GAAdA,cAAc;IACd,KAAAC,cAAc,GAAdA,cAAc;IACd,KAAAC,cAAc,GAAdA,cAAc;IAbxB,KAAAC,YAAY,GAAgC,IAAI;IAChD,KAAAC,WAAW,GAAW,EAAE;IACxB,KAAAC,OAAO,GAAW,QAAQ;IAC1B,KAAAC,MAAM,GAAkB,IAAI;IAC5B,KAAAC,MAAM,GAAY,KAAK;IAEvB,KAAAC,YAAY,GAAgB,IAAI;IAyGhC,KAAAC,OAAO,GAAW,EAAE;IAMpB,KAAAC,eAAe,GAAS,KAAK;IAtG3B,IAAI,CAACC,aAAa,GAAGC,MAAM,CAACC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;EAClE;EAEAC,QAAQA,CAAA;IACN,IAAI,CAACT,MAAM,GAAGM,MAAM,CAAC,IAAI,CAACd,KAAK,CAACkB,QAAQ,CAACC,QAAQ,CAACC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC5D,IAAI,CAACX,MAAM,GAAG,CAAC,CAAC,IAAI,CAACD,MAAM;IAE3B,IAAI,IAAI,CAACC,MAAM,IAAI,IAAI,CAACD,MAAM,EAAE;MAC9B,IAAI,CAACN,cAAc,CAACmB,WAAW,CAAC,IAAI,CAACb,MAAM,CAAC,CAACc,SAAS,CAAC;QACrDC,IAAI,EAAGC,IAAI,IAAI;UACb,IAAI,CAAClB,WAAW,GAAGkB,IAAI,CAACC,OAAO;UAC/B,IAAI,CAAClB,OAAO,GAAGiB,IAAI,CAACjB,OAAO;UAC3B,IAAI,CAACF,YAAY,GAAGmB,IAAI,CAACE,QAAQ,IAAI,IAAI;QAC3C,CAAC;QACDC,KAAK,EAAGC,GAAG,IAAI;UACbC,OAAO,CAACF,KAAK,CAAC,oBAAoB,EAAEC,GAAG,CAAC;QAC1C;OACD,CAAC;;EAEN;EAEAE,eAAeA,CAACC,KAAU;IACxB,MAAMC,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;IAClC,IAAIF,IAAI,EAAE;MACR,IAAI,CAACtB,YAAY,GAAGsB,IAAI;MACxB,MAAMG,MAAM,GAAG,IAAIC,UAAU,EAAE;MAC/BD,MAAM,CAACE,MAAM,GAAG,MAAK;QACnB,IAAI,CAAChC,YAAY,GAAG8B,MAAM,CAACG,MAAM;MACnC,CAAC;MACDH,MAAM,CAACI,aAAa,CAACP,IAAI,CAAC;;EAE9B;EAEAQ,OAAOA,CAACR,IAAS;IACf,OAAO,OAAOA,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACS,QAAQ,CAAC,UAAU,CAAC,IAAK,OAAOT,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACU,UAAU,CAAC,YAAY,CAAE;EAC7H;EAEAC,OAAOA,CAACX,IAAS;IACf,OAAO,OAAOA,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACS,QAAQ,CAAC,UAAU,CAAC,IAAK,OAAOT,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACU,UAAU,CAAC,YAAY,CAAE;EAC7H;EAEAE,QAAQA,CAAA;IACN,IAAI,CAAC,IAAI,CAACtC,WAAW,CAACuC,IAAI,EAAE,IAAI,CAAC,IAAI,CAACnC,YAAY,EAAE;MAClDoC,KAAK,CAAC,sBAAsB,CAAC;MAC7B;;IAGF,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,EAAE;IAC/BD,QAAQ,CAACE,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC3C,WAAW,CAAC;IAC5CyC,QAAQ,CAACE,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC1C,OAAO,CAAC;IAExC,IAAI,IAAI,CAACG,YAAY,EAAE;MACrBqC,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAE,IAAI,CAACvC,YAAY,CAAC;;IAG5C,IAAI,IAAI,CAACD,MAAM,IAAI,IAAI,CAACD,MAAM,EAAE;MAC9B;MACA,IAAI,CAACN,cAAc,CAACgD,UAAU,CAAC,IAAI,CAAC1C,MAAM,EAAEuC,QAAQ,CAAC,CAACzB,SAAS,CAAC;QAC9DC,IAAI,EAAEA,CAAA,KAAK;UACTuB,KAAK,CAAC,2BAA2B,CAAC;UAClC,IAAG,IAAI,CAAClC,eAAe,EAAE,IAAI,CAACuC,iBAAiB,CAAC,IAAI,CAAC3C,MAAM,CAAC;UAC5D,IAAI,CAACP,MAAM,CAACmD,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;QACpC,CAAC;QACDzB,KAAK,EAAGC,GAAG,IAAI;UACbC,OAAO,CAACF,KAAK,CAAC,qBAAqB,EAAEC,GAAG,CAAC;UACzCkB,KAAK,CAAC,uBAAuB,CAAC;QAChC;OACD,CAAC;KACH,MAAM;MACL;MACA,IAAI,CAAC5C,cAAc,CAACmD,UAAU,CAAC,IAAI,CAACxC,aAAa,EAAEkC,QAAQ,CAAC,CAACzB,SAAS,CAAC;QACrEC,IAAI,EAAE+B,IAAI,IAAG;UACXR,KAAK,CAAC,2BAA2B,CAAC;UAClC,IAAG,IAAI,CAAClC,eAAe,EAAE,IAAI,CAACuC,iBAAiB,CAACG,IAAI,CAAC9C,MAAM,CAAC;UAC5D,IAAI,CAACP,MAAM,CAACmD,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;QACpC,CAAC;QACDzB,KAAK,EAAGC,GAAG,IAAI;UACbC,OAAO,CAACF,KAAK,CAAC,qBAAqB,EAAEC,GAAG,CAAC;UACzCkB,KAAK,CAAC,uBAAuB,CAAC;QAChC;OACD,CAAC;;EAEN;EAEAS,UAAUA,CAAA;IACR,IAAI,CAACtD,MAAM,CAACmD,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;EACpC;EAEAI,YAAYA,CAAA;IACV,IAAI,CAACrD,cAAc,CAACsD,UAAU,CAAC1C,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAACM,SAAS,CAAC;MACvEC,IAAI,EAAE+B,IAAI,IAAG;QACX,IAAI,CAAC3C,OAAO,GAAC2C,IAAI,CAACI,GAAG,CAACC,CAAC,IAAE;UAACA,CAAC,CAACC,QAAQ,GAAC,KAAK;UAAE,OAAOD,CAAC;QAAC,CAAC,CAAC;MACzD,CAAC;MACDhC,KAAK,EAAEC,GAAG,IAAIC,OAAO,CAACF,KAAK,CAAC,iCAAiC,EAAEC,GAAG;KACnE,CAAC;EACJ;EAGAiC,KAAKA,CAACC,QAAY;IAChB,IAAI,CAACnD,OAAO,CAACmD,QAAQ,CAAC,CAACF,QAAQ,GAAC,CAAC,IAAI,CAACjD,OAAO,CAACmD,QAAQ,CAAC,CAACF,QAAQ;EAClE;EAGAG,eAAeA,CAAChC,KAAS;IACvB,IAAI,CAACnB,eAAe,GAAC,IAAI,CAACL,OAAO,KAAG,QAAQ;EAC9C;EAEA4C,iBAAiBA,CAAC3C,MAAkB;IAClC,MAAMwD,eAAe,GAAC,IAAI,CAACrD,OAAO,CAACsD,MAAM,CAACC,CAAC,IAAEA,CAAC,CAACN,QAAQ,CAAC;IACxDI,eAAe,CAACG,OAAO,CAACC,MAAM,IAAG,IAAI,CAAChE,cAAc,CAACiE,OAAO,CAAC7D,MAAM,EAAC4D,MAAM,CAACE,MAAM,EAAC,QAAQ,CAAC,CAAChD,SAAS,CAAC;MACpGC,IAAI,EAAE+B,IAAI,IAAEzB,OAAO,CAAC0C,GAAG,CAACjB,IAAI,CAAC;MAC7B3B,KAAK,EAAEC,GAAG,IAAEC,OAAO,CAAC0C,GAAG,CAAC,QAAQ,EAAC3C,GAAG;KACnC,CAAC,CAAC;EACP;CAED;AAnIY9B,mBAAmB,GAAA0E,UAAA,EAL/B3E,SAAS,CAAC;EACT4E,QAAQ,EAAE,iBAAiB;EAC3BC,WAAW,EAAE,8BAA8B;EAC3CC,SAAS,EAAE,CAAC,6BAA6B;CAC1C,CAAC,C,EACW7E,mBAAmB,CAmI/B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}