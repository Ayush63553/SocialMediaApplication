{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../../profile/user.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction FeedComponent_div_3_div_16_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 29);\n  }\n  if (rf & 2) {\n    const post_r1 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵproperty(\"src\", post_r1.mediaUrl, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction FeedComponent_div_3_div_16_video_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"video\", 30);\n  }\n  if (rf & 2) {\n    const post_r1 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵproperty(\"src\", post_r1.mediaUrl, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction FeedComponent_div_3_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵtemplate(1, FeedComponent_div_3_div_16_img_1_Template, 1, 1, \"img\", 27);\n    i0.ɵɵtemplate(2, FeedComponent_div_3_div_16_video_2_Template, 1, 1, \"video\", 28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const post_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", post_r1.mediaType == null ? null : post_r1.mediaType.startsWith(\"image\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", post_r1.mediaType == null ? null : post_r1.mediaType.startsWith(\"video\"));\n  }\n}\nfunction FeedComponent_div_3_div_36_div_5_div_1_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 43);\n    i0.ɵɵlistener(\"click\", function FeedComponent_div_3_div_36_div_5_div_1_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const comment_r11 = i0.ɵɵnextContext().$implicit;\n      const post_r1 = i0.ɵɵnextContext(3).$implicit;\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.deleteComment(post_r1, comment_r11));\n    });\n    i0.ɵɵtext(1, \" Delete \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FeedComponent_div_3_div_36_div_5_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 38);\n    i0.ɵɵelement(1, \"img\", 39);\n    i0.ɵɵelementStart(2, \"div\", 40)(3, \"div\", 41)(4, \"strong\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\")(7, \"small\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, FeedComponent_div_3_div_36_div_5_div_1_button_10_Template, 2, 0, \"button\", 42);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const comment_r11 = ctx.$implicit;\n    const post_r1 = i0.ɵɵnextContext(3).$implicit;\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", comment_r11.profilePictureUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(comment_r11.username);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(9, 5, comment_r11.createdAt, \"fullDate\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.canDeleteComment(post_r1, comment_r11));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(comment_r11.content);\n  }\n}\nfunction FeedComponent_div_3_div_36_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, FeedComponent_div_3_div_36_div_5_div_1_Template, 13, 8, \"div\", 37);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const post_r1 = i0.ɵɵnextContext(2).$implicit;\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r9.commentsMap[post_r1.postId]);\n  }\n}\nfunction FeedComponent_div_3_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"textarea\", 33);\n    i0.ɵɵlistener(\"ngModelChange\", function FeedComponent_div_3_div_36_Template_textarea_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const post_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.newCommentText[post_r1.postId] = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function FeedComponent_div_3_div_36_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const post_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.addComment(post_r1));\n    });\n    i0.ɵɵelement(4, \"i\", 35);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(5, FeedComponent_div_3_div_36_div_5_Template, 2, 1, \"div\", 36);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const post_r1 = i0.ɵɵnextContext().$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.newCommentText[post_r1.postId]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.commentsMap[post_r1.postId] != null && ctx_r3.commentsMap[post_r1.postId] != undefined && ctx_r3.commentsMap[post_r1.postId].length > 0);\n  }\n}\nfunction FeedComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"div\", 7)(3, \"div\", 8);\n    i0.ɵɵelement(4, \"img\", 9);\n    i0.ɵɵelementStart(5, \"div\")(6, \"h6\", 10)(7, \"strong\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"small\", 11);\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"date\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"div\");\n    i0.ɵɵelement(13, \"i\", 12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"p\", 13);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, FeedComponent_div_3_div_16_Template, 3, 2, \"div\", 14);\n    i0.ɵɵelementStart(17, \"div\", 15)(18, \"div\", 8);\n    i0.ɵɵelement(19, \"i\", 16);\n    i0.ɵɵelementStart(20, \"span\", 17);\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"div\")(23, \"span\", 18);\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(25, \"hr\");\n    i0.ɵɵelementStart(26, \"div\", 19)(27, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function FeedComponent_div_3_Template_button_click_27_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r26);\n      const post_r1 = restoredCtx.$implicit;\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.toggleLike(post_r1));\n    });\n    i0.ɵɵelement(28, \"i\", 21);\n    i0.ɵɵtext(29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function FeedComponent_div_3_Template_button_click_30_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r26);\n      const post_r1 = restoredCtx.$implicit;\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.dislikePost(post_r1));\n    });\n    i0.ɵɵelement(31, \"i\", 22);\n    i0.ɵɵtext(32, \" Dislike \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function FeedComponent_div_3_Template_button_click_33_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r26);\n      const post_r1 = restoredCtx.$implicit;\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.toggleComments(post_r1));\n    });\n    i0.ɵɵelement(34, \"i\", 24);\n    i0.ɵɵtext(35, \" Comments \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(36, FeedComponent_div_3_div_36_Template, 6, 2, \"div\", 25);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const post_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"src\", post_r1.profilePictureUrl || \"assets/images/default-avatar.png\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(post_r1.username);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 10, post_r1.createdAt, \"fullDate\"));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(post_r1.content);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", post_r1.mediaUrl);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(post_r1.likeCount || 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.commentsMap[post_r1.postId].length || 0, \" comments\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", post_r1.likedByUsers.includes(ctx_r0.loggedInUsername) ? \"bi-hand-thumbs-up-fill text-primary\" : \"bi-hand-thumbs-up\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", post_r1.likedByUsers.includes(ctx_r0.loggedInUsername) ? \"Liked\" : \"Like\", \" \");\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showCommentsMap[post_r1.postId] != null && ctx_r0.showCommentsMap[post_r1.postId] != undefined && ctx_r0.showCommentsMap[post_r1.postId]);\n  }\n}\nconst BASE = 'http://localhost:8765';\nexport class FeedComponent {\n  constructor(http, userService) {\n    this.http = http;\n    this.userService = userService;\n    this.posts = [];\n    this.commentsMap = {};\n    this.showCommentsMap = {};\n    this.newCommentText = {};\n  }\n  ngOnInit() {\n    this.userService.getMe().subscribe({\n      next: user => {\n        this.loggedInUserId = user.userId;\n        this.loggedInUsername = user.username;\n        this.loadFeed();\n      },\n      error: err => console.error('Failed to load logged-in user', err)\n    });\n  }\n  // Load posts (friends + own posts, sorted in backend)\n  loadFeed() {\n    this.http.get(`${BASE}/api/posts/feed/${this.loggedInUserId}`).subscribe(posts => {\n      this.posts = posts.map(p => ({\n        ...p,\n        likedByUsers: p.likedByUsers || [],\n        comments: p.comments || []\n      }));\n      this.posts.forEach(p => {\n        this.showCommentsMap[p.postId] = false;\n        this.commentsMap[p.postId] = p.comments || [];\n      });\n    }, err => console.error('Failed to load posts', err));\n  }\n  // Toggle like/unlike\n  toggleLike(post) {\n    const payload = {\n      postId: post.postId,\n      userId: this.loggedInUserId\n    };\n    if (post.likedByUsers.includes(this.loggedInUsername)) {\n      // Unlike\n      this.http.delete(`${BASE}/api/likes/${post.postId}/user/${this.loggedInUserId}`).subscribe(() => {\n        post.likeCount = Math.max(0, post.likeCount - 1);\n        post.likedByUsers = post.likedByUsers.filter(u => u !== this.loggedInUsername);\n      }, err => console.error('Failed to unlike', err));\n    } else {\n      // Like\n      this.http.post(`${BASE}/api/likes`, payload).subscribe({\n        next: res => {\n          post.likeCount = res?.likeCount ?? post.likeCount + 1;\n          if (!post.likedByUsers.includes(this.loggedInUsername)) {\n            post.likedByUsers.push(this.loggedInUsername);\n          }\n        },\n        error: err => console.error('Failed to like', err)\n      });\n    }\n  }\n  // Dislike = same as unlike (ensure UI updates)\n  dislikePost(post) {\n    this.http.delete(`${BASE}/api/likes/${post.postId}/user/${this.loggedInUserId}`, {\n      responseType: 'text'\n    }).subscribe(() => {\n      if (post.likedByUsers.includes(this.loggedInUsername)) {\n        post.likeCount = Math.max(0, post.likeCount - 1);\n        post.likedByUsers = post.likedByUsers.filter(u => u !== this.loggedInUsername);\n      }\n    }, err => console.error('Dislike failed', err));\n  }\n  // Toggle comments\n  toggleComments(post) {\n    this.showCommentsMap[post.postId] = !this.showCommentsMap[post.postId];\n    if (this.showCommentsMap[post.postId]) {\n      this.loadComments(post.postId);\n    }\n  }\n  // Load comments (ensure username comes from backend)\n  loadComments(postId) {\n    this.http.get(`${BASE}/api/comments/post/${postId}`).subscribe(data => {\n      // If backend doesn’t send username, fallback\n      this.commentsMap[postId] = data.map(c => ({\n        ...c,\n        username: c.username || `User ${c.userId}`\n      }));\n    }, err => console.error('Failed to load comments', err));\n  }\n  // Add comment\n  addComment(post) {\n    const text = (this.newCommentText[post.postId] || '').trim();\n    if (!text) return;\n    const payload = {\n      postId: post.postId,\n      userId: this.loggedInUserId,\n      content: text\n    };\n    this.http.post(`${BASE}/api/comments`, payload).subscribe(created => {\n      created.username = this.loggedInUsername; // ✅ attach logged-in user\n      this.commentsMap[post.postId] = this.commentsMap[post.postId] || [];\n      this.commentsMap[post.postId].push(created);\n      this.newCommentText[post.postId] = '';\n    }, err => console.error('Failed to add comment', err));\n  }\n  // Delete comment\n  deleteComment(post, comment) {\n    this.http.delete(`${BASE}/api/comments/${comment.commentId}?userId=${this.loggedInUserId}`).subscribe(() => {\n      this.commentsMap[post.postId] = this.commentsMap[post.postId].filter(c => c.commentId !== comment.commentId);\n    }, err => console.error('Failed to delete comment', err));\n  }\n  // Can delete comment?\n  canDeleteComment(post, comment) {\n    return comment.userId === this.loggedInUserId || post.userId === this.loggedInUserId;\n  }\n  static {\n    this.ɵfac = function FeedComponent_Factory(t) {\n      return new (t || FeedComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.UserService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FeedComponent,\n      selectors: [[\"app-feed\"]],\n      decls: 5,\n      vars: 1,\n      consts: [[1, \"container\", \"my-4\"], [1, \"row\"], [1, \"col-md-8\"], [\"class\", \"card shadow-sm rounded-3 mb-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-md-4\"], [1, \"card\", \"shadow-sm\", \"rounded-3\", \"mb-4\"], [1, \"card-body\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-2\"], [1, \"d-flex\", \"align-items-center\"], [\"alt\", \"profile\", 1, \"rounded-circle\", \"me-2\", 2, \"width\", \"3rem\", \"height\", \"3rem\", 3, \"src\"], [1, \"mb-0\"], [1, \"text-muted\"], [1, \"bi\", \"bi-three-dots\"], [1, \"mb-2\"], [\"class\", \"mb-3\", 4, \"ngIf\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mt-2\"], [1, \"bi\", \"bi-hand-thumbs-up-fill\", \"text-primary\", \"me-1\"], [1, \"small\"], [1, \"small\", \"text-muted\"], [1, \"d-flex\", \"justify-content-around\", \"text-muted\"], [1, \"btn\", \"btn-light\", \"btn-sm\", \"w-100\", \"me-1\", 3, \"click\"], [1, \"bi\", 3, \"ngClass\"], [1, \"bi\", \"bi-hand-thumbs-down\"], [1, \"btn\", \"btn-light\", \"btn-sm\", \"w-100\", 3, \"click\"], [1, \"bi\", \"bi-chat-dots\"], [\"class\", \"mt-3\", 4, \"ngIf\"], [1, \"mb-3\"], [\"class\", \"img-fluid rounded shadow-sm\", \"alt\", \"Post image\", 3, \"src\", 4, \"ngIf\"], [\"class\", \"w-100 rounded shadow-sm\", \"controls\", \"\", 3, \"src\", 4, \"ngIf\"], [\"alt\", \"Post image\", 1, \"img-fluid\", \"rounded\", \"shadow-sm\", 3, \"src\"], [\"controls\", \"\", 1, \"w-100\", \"rounded\", \"shadow-sm\", 3, \"src\"], [1, \"mt-3\"], [1, \"input-group\", \"mb-3\"], [\"rows\", \"1\", \"placeholder\", \"Write a comment...\", 1, \"form-control\", \"me-2\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"bi\", \"bi-send\"], [4, \"ngIf\"], [\"class\", \"d-flex align-items-start mb-2\", 4, \"ngFor\", \"ngForOf\"], [1, \"d-flex\", \"align-items-start\", \"mb-2\"], [1, \"rounded-circle\", \"me-2\", 2, \"width\", \"30px\", \"height\", \"30px\", 3, \"src\"], [1, \"bg-light\", \"rounded\", \"p-2\", \"w-100\"], [1, \"d-flex\", \"justify-content-between\"], [\"class\", \"btn btn-sm btn-link text-danger\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-link\", \"text-danger\", 3, \"click\"]],\n      template: function FeedComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n          i0.ɵɵtemplate(3, FeedComponent_div_3_Template, 37, 13, \"div\", 3);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(4, \"div\", 4);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.posts);\n        }\n      },\n      dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i3.DatePipe],\n      styles: [\"*[_ngcontent-%COMP%]{\\n    font-family: 'Rubik', sans-serif;\\n}\\n.feed[_ngcontent-%COMP%] {\\n    max-width: 600px;\\n    margin: auto;\\n    margin-top: 20px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZmVhdHVyZXMvaG9tZS9mZWVkL2ZlZWQuY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQUNJLGdDQUFnQztBQUNwQztBQUNBO0lBQ0ksZ0JBQWdCO0lBQ2hCLFlBQVk7SUFDWixnQkFBZ0I7QUFDcEIiLCJzb3VyY2VzQ29udGVudCI6WyIqe1xyXG4gICAgZm9udC1mYW1pbHk6ICdSdWJpaycsIHNhbnMtc2VyaWY7XHJcbn1cclxuLmZlZWQge1xyXG4gICAgbWF4LXdpZHRoOiA2MDBweDtcclxuICAgIG1hcmdpbjogYXV0bztcclxuICAgIG1hcmdpbi10b3A6IDIwcHg7XHJcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n    });\n  }\n}","map":{"version":3,"names":["i0","ɵɵelement","ɵɵproperty","post_r1","mediaUrl","ɵɵsanitizeUrl","ɵɵelementStart","ɵɵtemplate","FeedComponent_div_3_div_16_img_1_Template","FeedComponent_div_3_div_16_video_2_Template","ɵɵelementEnd","ɵɵadvance","mediaType","startsWith","ɵɵlistener","FeedComponent_div_3_div_36_div_5_div_1_button_10_Template_button_click_0_listener","ɵɵrestoreView","_r15","comment_r11","ɵɵnextContext","$implicit","ctx_r13","ɵɵresetView","deleteComment","ɵɵtext","FeedComponent_div_3_div_36_div_5_div_1_button_10_Template","profilePictureUrl","ɵɵtextInterpolate","username","ɵɵpipeBind2","createdAt","ctx_r10","canDeleteComment","content","FeedComponent_div_3_div_36_div_5_div_1_Template","ctx_r9","commentsMap","postId","FeedComponent_div_3_div_36_Template_textarea_ngModelChange_2_listener","$event","_r20","ctx_r19","newCommentText","FeedComponent_div_3_div_36_Template_button_click_3_listener","ctx_r22","addComment","FeedComponent_div_3_div_36_div_5_Template","ctx_r3","undefined","length","FeedComponent_div_3_div_16_Template","FeedComponent_div_3_Template_button_click_27_listener","restoredCtx","_r26","ctx_r25","toggleLike","FeedComponent_div_3_Template_button_click_30_listener","ctx_r27","dislikePost","FeedComponent_div_3_Template_button_click_33_listener","ctx_r28","toggleComments","FeedComponent_div_3_div_36_Template","likeCount","ɵɵtextInterpolate1","ctx_r0","likedByUsers","includes","loggedInUsername","showCommentsMap","BASE","FeedComponent","constructor","http","userService","posts","ngOnInit","getMe","subscribe","next","user","loggedInUserId","userId","loadFeed","error","err","console","get","map","p","comments","forEach","post","payload","delete","Math","max","filter","u","res","push","responseType","loadComments","data","c","text","trim","created","comment","commentId","ɵɵdirectiveInject","i1","HttpClient","i2","UserService","selectors","decls","vars","consts","template","FeedComponent_Template","rf","ctx","FeedComponent_div_3_Template"],"sources":["C:\\Users\\ayushman.jha01\\Saved Games\\Facebook_group3\\group3-frontend\\src\\app\\features\\home\\feed\\feed.component.ts","C:\\Users\\ayushman.jha01\\Saved Games\\Facebook_group3\\group3-frontend\\src\\app\\features\\home\\feed\\feed.component.html"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { User, UserService } from '../../profile/user.service';\r\n\r\nconst BASE = 'http://localhost:8765';\r\n\r\ninterface Post {\r\n  postId: number;\r\n  userId: number;\r\n  username: string;\r\n  content: string;\r\n  mediaUrl?: string;\r\n  mediaType?:string\r\n  profilePictureUrl?:string;\r\n  likeCount: number;\r\n  likedByUsers: string[];\r\n  createdAt?: string;\r\n  comments: Comment[];\r\n}\r\n\r\ninterface Comment {\r\n  commentId: number;\r\n  postId: number;\r\n  userId: number;\r\n  username: string;\r\n  content: string;\r\n  createdAt?: string;\r\n  profilePictureUrl?:string\r\n}\r\n\r\n@Component({\r\n  selector: 'app-feed',\r\n  templateUrl: './feed.component.html',\r\n  styleUrls: ['./feed.component.css']\r\n})\r\nexport class FeedComponent implements OnInit {\r\n  posts: Post[] = [];\r\n  commentsMap: { [postId: number]: Comment[] } = {};\r\n  showCommentsMap: { [postId: number]: boolean } = {};\r\n  newCommentText: { [postId: number]: string } = {};\r\n\r\n  loggedInUserId!: number;\r\n  loggedInUsername!: string;\r\n\r\n  constructor(private http: HttpClient, private userService: UserService) {}\r\n\r\n  ngOnInit(): void {\r\n    this.userService.getMe().subscribe({\r\n      next: (user: User) => {\r\n        this.loggedInUserId = user.userId;\r\n        this.loggedInUsername = user.username;\r\n        this.loadFeed();\r\n      },\r\n      error: (err) => console.error('Failed to load logged-in user', err)\r\n    });\r\n  }\r\n\r\n  // Load posts (friends + own posts, sorted in backend)\r\n  loadFeed() {\r\n    this.http.get<Post[]>(`${BASE}/api/posts/feed/${this.loggedInUserId}`).subscribe(posts => {\r\n      this.posts = posts.map(p => ({\r\n        ...p,\r\n        likedByUsers: p.likedByUsers || [],\r\n        comments: p.comments || []\r\n      }));\r\n      this.posts.forEach(p => {\r\n        this.showCommentsMap[p.postId] = false;\r\n        this.commentsMap[p.postId] = p.comments || [];\r\n      });\r\n    }, err => console.error('Failed to load posts', err));\r\n  }\r\n\r\n  // Toggle like/unlike\r\n  toggleLike(post: Post) {\r\n    const payload = { postId: post.postId, userId: this.loggedInUserId };\r\n\r\n    if (post.likedByUsers.includes(this.loggedInUsername)) {\r\n      // Unlike\r\n      this.http.delete(`${BASE}/api/likes/${post.postId}/user/${this.loggedInUserId}`)\r\n        .subscribe(() => {\r\n          post.likeCount = Math.max(0, post.likeCount - 1);\r\n          post.likedByUsers = post.likedByUsers.filter(u => u !== this.loggedInUsername);\r\n        }, err => console.error('Failed to unlike', err));\r\n    } else {\r\n      // Like\r\n      this.http.post<any>(`${BASE}/api/likes`, payload).subscribe({\r\n        next: (res) => {\r\n          post.likeCount = res?.likeCount ?? (post.likeCount + 1);\r\n          if (!post.likedByUsers.includes(this.loggedInUsername)) {\r\n            post.likedByUsers.push(this.loggedInUsername);\r\n          }\r\n        },\r\n        error: (err) => console.error('Failed to like', err)\r\n      });\r\n    }\r\n  }\r\n\r\n  // Dislike = same as unlike (ensure UI updates)\r\n  dislikePost(post: Post) {\r\n    this.http.delete(`${BASE}/api/likes/${post.postId}/user/${this.loggedInUserId}`, { responseType : 'text'})\r\n      .subscribe(() => {\r\n        if (post.likedByUsers.includes(this.loggedInUsername)) {\r\n          post.likeCount = Math.max(0, post.likeCount - 1);\r\n          post.likedByUsers = post.likedByUsers.filter(u => u !== this.loggedInUsername);\r\n        }\r\n      }, err => console.error('Dislike failed', err));\r\n  }\r\n\r\n  // Toggle comments\r\n  toggleComments(post: Post) {\r\n    this.showCommentsMap[post.postId] = !this.showCommentsMap[post.postId];\r\n    if (this.showCommentsMap[post.postId]) {\r\n      this.loadComments(post.postId);\r\n    }\r\n  }\r\n\r\n  // Load comments (ensure username comes from backend)\r\n  loadComments(postId: number) {\r\n    this.http.get<Comment[]>(`${BASE}/api/comments/post/${postId}`)\r\n      .subscribe(data => {\r\n        // If backend doesn’t send username, fallback\r\n        this.commentsMap[postId] = data.map(c => ({\r\n          ...c,\r\n          username: c.username || `User ${c.userId}`\r\n        }));\r\n      }, err => console.error('Failed to load comments', err));\r\n  }\r\n\r\n  // Add comment\r\n  addComment(post: Post) {\r\n    const text = (this.newCommentText[post.postId] || '').trim();\r\n    if (!text) return;\r\n\r\n    const payload = { postId: post.postId, userId: this.loggedInUserId, content: text };\r\n    this.http.post<Comment>(`${BASE}/api/comments`, payload)\r\n      .subscribe(created => {\r\n        created.username = this.loggedInUsername; // ✅ attach logged-in user\r\n        this.commentsMap[post.postId] = this.commentsMap[post.postId] || [];\r\n        this.commentsMap[post.postId].push(created);\r\n        this.newCommentText[post.postId] = '';\r\n      }, err => console.error('Failed to add comment', err));\r\n  }\r\n\r\n  // Delete comment\r\n  deleteComment(post: Post, comment: Comment) {\r\n    this.http.delete(`${BASE}/api/comments/${comment.commentId}?userId=${this.loggedInUserId}`)\r\n      .subscribe(() => {\r\n        this.commentsMap[post.postId] =\r\n          this.commentsMap[post.postId].filter(c => c.commentId !== comment.commentId);\r\n      }, err => console.error('Failed to delete comment', err));\r\n  }\r\n\r\n  // Can delete comment?\r\n  canDeleteComment(post: Post, comment: Comment) {\r\n    return comment.userId === this.loggedInUserId || post.userId === this.loggedInUserId;\r\n  }\r\n}","<div class=\"container my-4\">\r\n  <div class=\"row\">\r\n    <div class=\"col-md-8\">\r\n      <div *ngFor=\"let post of posts\" class=\"card shadow-sm rounded-3 mb-4\">\r\n        <div class=\"card-body\">\r\n          <!-- Post Header -->\r\n          <div class=\"d-flex justify-content-between align-items-center mb-2\">\r\n            <div class=\"d-flex align-items-center\">\r\n              <img [src]=\"post.profilePictureUrl || 'assets/images/default-avatar.png'\"\r\n                   class=\"rounded-circle me-2\"\r\n                   style=\"width: 3rem; height: 3rem;\"\r\n                   alt=\"profile\">\r\n              <div>\r\n                <h6 class=\"mb-0\"><strong>{{ post.username }}</strong></h6>\r\n                <small class=\"text-muted\">{{ post.createdAt | date:'fullDate' }}</small>\r\n              </div>\r\n            </div>\r\n            <div><i class=\"bi bi-three-dots\"></i></div>\r\n          </div>\r\n\r\n          <!-- Post content -->\r\n          <p class=\"mb-2\">{{ post.content }}</p>\r\n\r\n          <!-- Post Media (image or video) -->\r\n          <div *ngIf=\"post.mediaUrl\" class=\"mb-3\">\r\n            <!-- Image -->\r\n            <img *ngIf=\"post.mediaType?.startsWith('image')\"\r\n                 [src]=\"post.mediaUrl\"\r\n                 class=\"img-fluid rounded shadow-sm\"\r\n                 alt=\"Post image\">\r\n\r\n            <!-- Video -->\r\n            <video *ngIf=\"post.mediaType?.startsWith('video')\"\r\n                   [src]=\"post.mediaUrl\"\r\n                   class=\"w-100 rounded shadow-sm\"\r\n                   controls>\r\n            </video>\r\n          </div>\r\n\r\n          <!-- Reaction summary -->\r\n          <div class=\"d-flex justify-content-between align-items-center mt-2\">\r\n            <div class=\"d-flex align-items-center\">\r\n              <i class=\"bi bi-hand-thumbs-up-fill text-primary me-1\"></i>\r\n              <span class=\"small\">{{ post.likeCount || 0 }}</span>\r\n            </div>\r\n            <div>\r\n              <span class=\"small text-muted\">{{ commentsMap[post.postId].length || 0 }} comments</span>\r\n            </div>\r\n          </div>\r\n\r\n          <hr>\r\n\r\n          <!-- Action buttons -->\r\n          <div class=\"d-flex justify-content-around text-muted\">\r\n            <button class=\"btn btn-light btn-sm w-100 me-1\" (click)=\"toggleLike(post)\">\r\n              <i class=\"bi\"\r\n                 [ngClass]=\"post.likedByUsers.includes(loggedInUsername)\r\n                              ? 'bi-hand-thumbs-up-fill text-primary'\r\n                              : 'bi-hand-thumbs-up'\"></i>\r\n              {{ post.likedByUsers.includes(loggedInUsername) ? 'Liked' : 'Like' }}\r\n            </button>\r\n\r\n            <button class=\"btn btn-light btn-sm w-100 me-1\" (click)=\"dislikePost(post)\">\r\n              <i class=\"bi bi-hand-thumbs-down\"></i> Dislike\r\n            </button>\r\n\r\n            <button class=\"btn btn-light btn-sm w-100\" (click)=\"toggleComments(post)\">\r\n              <i class=\"bi bi-chat-dots\"></i> Comments\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Comments section -->\r\n          <div *ngIf=\"showCommentsMap[post.postId]!=null && showCommentsMap[post.postId]!=undefined && showCommentsMap[post.postId]\" class=\"mt-3\">\r\n            <!-- Add comment -->\r\n            <div class=\"input-group mb-3\">\r\n              <textarea class=\"form-control me-2\"\r\n                        [(ngModel)]=\"newCommentText[post.postId]\"\r\n                        rows=\"1\"\r\n                        placeholder=\"Write a comment...\"></textarea>\r\n              <button class=\"btn btn-primary\" (click)=\"addComment(post)\">\r\n                <i class=\"bi bi-send\"></i>\r\n              </button>\r\n            </div>\r\n\r\n            <!-- Existing comments -->\r\n            <div *ngIf=\"commentsMap[post.postId]!=null && commentsMap[post.postId]!=undefined && commentsMap[post.postId].length>0\">\r\n              <div *ngFor=\"let comment of commentsMap[post.postId]\" class=\"d-flex align-items-start mb-2\">\r\n                <img [src]=\"comment.profilePictureUrl\"\r\n                class=\"rounded-circle me-2\"\r\n                   style=\"width:30px; height:30px;\">\r\n              <div class=\"bg-light rounded p-2 w-100\">\r\n                <div class=\"d-flex justify-content-between\">\r\n                  <strong>{{ comment.username }}</strong>\r\n                  <div>\r\n                    <small class=\"text-muted\">{{ comment.createdAt | date: 'fullDate'}}</small>\r\n                    <button *ngIf=\"canDeleteComment(post, comment)\"\r\n                            class=\"btn btn-sm btn-link text-danger\"\r\n                            (click)=\"deleteComment(post, comment)\">\r\n                      Delete\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div>{{ comment.content }}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Right sidebar -->\r\n    <div class=\"col-md-4\">\r\n      <!-- keep your ads/contacts/groups section -->\r\n    </div>\r\n  </div>\r\n</div>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}