{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.USER_ID = 'userId';\n    this.apiUrl = 'http://localhost:8765/api/auth';\n    this.tokenKey = 'mysecretkeymysecretkeymysecretkey12345';\n    this.loggedIn = new BehaviorSubject(this.hasValidToken());\n    this.isLoggedIn$ = this.loggedIn.asObservable();\n  }\n  login(payload) {\n    return this.http.post(`${this.apiUrl}/login`, payload).pipe(tap(response => {\n      if (response.userId) {\n        localStorage.setItem(this.USER_ID, response.userId.toString());\n      }\n      if (response.token) {\n        localStorage.setItem(this.tokenKey, response.token);\n        this.startAutoLogoutTimer(response.token);\n        this.loggedIn.next(true);\n      }\n    }));\n  }\n  loginp(userId) {\n    localStorage.setItem(this.USER_ID, userId.toString());\n  }\n  logout() {\n    localStorage.removeItem(this.tokenKey);\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n    this.loggedIn.next(null);\n    this.router.navigate(['/auth']);\n  }\n  getToken() {\n    return localStorage.getItem(this.tokenKey);\n  }\n  isLoggedIn() {\n    const token = this.getToken();\n    if (!token) return false;\n    const payload = this.decodeToken(token);\n    if (!payload) return false;\n    const expiry = payload.exp * 1000; // seconds â†’ ms\n    return Date.now() < expiry;\n  }\n  decodeToken(token) {\n    try {\n      return JSON.parse(atob(token.split('.')[1]));\n    } catch (e) {\n      return null;\n    }\n  }\n  hasValidToken() {\n    const token = this.getToken();\n    if (!token) return false;\n    const payload = this.decodeToken(token);\n    if (!payload) return false;\n    const expiry = payload.exp * 1000;\n    return Date.now() < expiry;\n  }\n  getUserId() {\n    const id = localStorage.getItem(this.USER_ID);\n    return Number(id);\n  }\n  // ðŸ”¹ Auto logout based on token expiry\n  startAutoLogoutTimer(token) {\n    const payload = this.decodeToken(token);\n    if (!payload) return;\n    const expiry = payload.exp * 1000;\n    const timeLeft = expiry - Date.now();\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n    this.logoutTimer = setTimeout(() => {\n      alert('Session expired. Please log in again.');\n      this.logout();\n    }, timeLeft);\n  }\n  static {\n    this.Éµfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ÉµÉµinject(i1.HttpClient), i0.ÉµÉµinject(i2.Router));\n    };\n  }\n  static {\n    this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: AuthService,\n      factory: AuthService.Éµfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","tap","AuthService","constructor","http","router","USER_ID","apiUrl","tokenKey","loggedIn","hasValidToken","isLoggedIn$","asObservable","login","payload","post","pipe","response","userId","localStorage","setItem","toString","token","startAutoLogoutTimer","next","loginp","logout","removeItem","logoutTimer","clearTimeout","navigate","getToken","getItem","isLoggedIn","decodeToken","expiry","exp","Date","now","JSON","parse","atob","split","e","getUserId","id","Number","timeLeft","setTimeout","alert","i0","ÉµÉµinject","i1","HttpClient","i2","Router","factory","Éµfac","providedIn"],"sources":["C:\\Users\\ayushman.jha01\\Saved Games\\Facebook_group3\\group3-frontend\\src\\app\\core\\services\\Login\\authLogin.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { Router } from '@angular/router';\r\n\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\n\r\nimport { tap } from 'rxjs/operators';\r\n\r\nexport interface LoginPayload {\r\n\r\n  username: string;\r\n\r\n  password: string;\r\n\r\n}\r\n\r\n@Injectable({\r\n\r\n  providedIn: 'root'\r\n\r\n})\r\n\r\nexport class AuthService {\r\n\r\n  private USER_ID='userId';\r\n\r\n  private apiUrl = 'http://localhost:8765/api/auth';\r\n\r\n  private tokenKey = 'mysecretkeymysecretkeymysecretkey12345';\r\n\r\n  private logoutTimer: any;\r\n\r\n  private loggedIn=new BehaviorSubject<boolean|null>(this.hasValidToken());\r\n  \r\n  isLoggedIn$=this.loggedIn.asObservable();\r\n\r\n  constructor(private http: HttpClient, private router: Router) {}\r\n\r\n  login(payload: LoginPayload): Observable<any> {\r\n\r\n    return this.http.post<{ token: string,userId:number }>(`${this.apiUrl}/login`, payload).pipe(\r\n\r\n      tap(response => {\r\n        if(response.userId){\r\n        localStorage.setItem(this.USER_ID,response.userId.toString());\r\n}\r\n\r\n        if (response.token) {\r\n \r\n         \r\n          localStorage.setItem(this.tokenKey, response.token);\r\n         \r\n\r\n          this.startAutoLogoutTimer(response.token);\r\n          this.loggedIn.next(true);\r\n        }\r\n   \r\n\r\n      })\r\n\r\n    );\r\n\r\n  }\r\n\r\n  loginp(userId:number){\r\n    localStorage.setItem(this.USER_ID,userId.toString());\r\n  }\r\n\r\n  logout(): void {\r\n\r\n    localStorage.removeItem(this.tokenKey);\r\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\r\n    this.loggedIn.next(null);\r\n    this.router.navigate(['/auth']);\r\n  }\r\n\r\n  getToken(): string | null {\r\n\r\n    return localStorage.getItem(this.tokenKey);\r\n\r\n  }\r\n\r\n  isLoggedIn(): boolean {\r\n\r\n    const token = this.getToken();\r\n\r\n    if (!token) return false;\r\n\r\n    const payload = this.decodeToken(token);\r\n\r\n    if (!payload) return false;\r\n\r\n    const expiry = payload.exp * 1000; // seconds â†’ ms\r\n\r\n    return Date.now() < expiry;\r\n\r\n  }\r\n\r\n  private decodeToken(token: string): any {\r\n\r\n    try {\r\n      return JSON.parse(atob(token.split('.')[1]));\r\n\r\n    } catch (e) {\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  private hasValidToken():boolean{\r\n    const token=this.getToken();\r\n    if(!token) return false;\r\n    const payload=this.decodeToken(token);\r\n    if(!payload) return false;\r\n    const expiry=payload.exp*1000;\r\n    return Date.now()<expiry;\r\n  }\r\n\r\n  getUserId():number{\r\n    const id=localStorage.getItem(this.USER_ID)\r\n    return Number(id);\r\n  }\r\n\r\n  // ðŸ”¹ Auto logout based on token expiry\r\n\r\n  private startAutoLogoutTimer(token: string): void {\r\n\r\n    const payload = this.decodeToken(token);\r\n\r\n    if (!payload) return;\r\n\r\n    const expiry = payload.exp * 1000;\r\n\r\n    const timeLeft = expiry - Date.now();\r\n\r\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\r\n\r\n    this.logoutTimer = setTimeout(() => {\r\n\r\n      alert('Session expired. Please log in again.');\r\n\r\n      this.logout();\r\n\r\n    }, timeLeft);\r\n\r\n  }\r\n\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}