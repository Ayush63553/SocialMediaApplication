{"ast":null,"code":"import { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.apiUrl = 'http://localhost:8765/api/auth';\n    this.tokenKey = 'mysecretkeymysecretkeymysecretkey12345';\n  }\n  login(payload) {\n    return this.http.post(`${this.apiUrl}/login`, payload).pipe(tap(response => {\n      if (response.token) {\n        localStorage.setItem(this.tokenKey, response.token);\n        this.startAutoLogoutTimer(response.token);\n      }\n    }));\n  }\n  logout() {\n    localStorage.removeItem(this.tokenKey);\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n    this.router.navigate(['/login']);\n  }\n  getToken() {\n    return localStorage.getItem(this.tokenKey);\n  }\n  isLoggedIn() {\n    const token = this.getToken();\n    if (!token) return false;\n    const payload = this.decodeToken(token);\n    if (!payload) return false;\n    const expiry = payload.exp * 1000; // seconds â†’ ms\n    return Date.now() < expiry;\n  }\n  decodeToken(token) {\n    try {\n      return JSON.parse(atob(token.split('.')[1]));\n    } catch (e) {\n      return null;\n    }\n  }\n  // ðŸ”¹ Auto logout based on token expiry\n  startAutoLogoutTimer(token) {\n    const payload = this.decodeToken(token);\n    if (!payload) return;\n    const expiry = payload.exp * 1000;\n    const timeLeft = expiry - Date.now();\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n    this.logoutTimer = setTimeout(() => {\n      alert('Session expired. Please log in again.');\n      this.logout();\n    }, timeLeft);\n  }\n  static {\n    this.Éµfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ÉµÉµinject(i1.HttpClient), i0.ÉµÉµinject(i2.Router));\n    };\n  }\n  static {\n    this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: AuthService,\n      factory: AuthService.Éµfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["tap","AuthService","constructor","http","router","apiUrl","tokenKey","login","payload","post","pipe","response","token","localStorage","setItem","startAutoLogoutTimer","logout","removeItem","logoutTimer","clearTimeout","navigate","getToken","getItem","isLoggedIn","decodeToken","expiry","exp","Date","now","JSON","parse","atob","split","e","timeLeft","setTimeout","alert","i0","ÉµÉµinject","i1","HttpClient","i2","Router","factory","Éµfac","providedIn"],"sources":["C:\\Users\\ayushman.jha01\\Saved Games\\Facebook_group3\\group3-frontend\\src\\app\\core\\services\\Login\\authLogin.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\n\nimport { Router } from '@angular/router';\n\nimport { Observable } from 'rxjs';\n\nimport { tap } from 'rxjs/operators';\n\nexport interface LoginPayload {\n\n  username: string;\n\n  password: string;\n\n}\n\n@Injectable({\n\n  providedIn: 'root'\n\n})\n\nexport class AuthService {\n\n  private apiUrl = 'http://localhost:8765/api/auth';\n\n  private tokenKey = 'mysecretkeymysecretkeymysecretkey12345';\n\n  private logoutTimer: any;\n\n\n  \n  constructor(private http: HttpClient, private router: Router) {}\n\n  login(payload: LoginPayload): Observable<any> {\n\n    return this.http.post<{ token: string }>(`${this.apiUrl}/login`, payload).pipe(\n\n      tap(response => {\n\n        if (response.token) {\n\n          localStorage.setItem(this.tokenKey, response.token);\n\n          this.startAutoLogoutTimer(response.token);\n\n        }\n\n      })\n\n    );\n\n  }\n\n  logout(): void {\n\n    localStorage.removeItem(this.tokenKey);\n\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n\n    this.router.navigate(['/login']);\n\n  }\n\n  getToken(): string | null {\n\n    return localStorage.getItem(this.tokenKey);\n\n  }\n\n  isLoggedIn(): boolean {\n\n    const token = this.getToken();\n\n    if (!token) return false;\n\n    const payload = this.decodeToken(token);\n\n    if (!payload) return false;\n\n    const expiry = payload.exp * 1000; // seconds â†’ ms\n\n    return Date.now() < expiry;\n\n  }\n\n  private decodeToken(token: string): any {\n\n    try {\n\n      return JSON.parse(atob(token.split('.')[1]));\n\n    } catch (e) {\n\n      return null;\n\n    }\n\n  }\n\n  // ðŸ”¹ Auto logout based on token expiry\n\n  private startAutoLogoutTimer(token: string): void {\n\n    const payload = this.decodeToken(token);\n\n    if (!payload) return;\n\n    const expiry = payload.exp * 1000;\n\n    const timeLeft = expiry - Date.now();\n\n    if (this.logoutTimer) clearTimeout(this.logoutTimer);\n\n    this.logoutTimer = setTimeout(() => {\n\n      alert('Session expired. Please log in again.');\n\n      this.logout();\n\n    }, timeLeft);\n\n  }\n\n}"],"mappings":"AAQA,SAASA,GAAG,QAAQ,gBAAgB;;;;AAgBpC,OAAM,MAAOC,WAAW;EAUtBC,YAAoBC,IAAgB,EAAUC,MAAc;IAAxC,KAAAD,IAAI,GAAJA,IAAI;IAAsB,KAAAC,MAAM,GAANA,MAAM;IAR5C,KAAAC,MAAM,GAAG,gCAAgC;IAEzC,KAAAC,QAAQ,GAAG,wCAAwC;EAMI;EAE/DC,KAAKA,CAACC,OAAqB;IAEzB,OAAO,IAAI,CAACL,IAAI,CAACM,IAAI,CAAoB,GAAG,IAAI,CAACJ,MAAM,QAAQ,EAAEG,OAAO,CAAC,CAACE,IAAI,CAE5EV,GAAG,CAACW,QAAQ,IAAG;MAEb,IAAIA,QAAQ,CAACC,KAAK,EAAE;QAElBC,YAAY,CAACC,OAAO,CAAC,IAAI,CAACR,QAAQ,EAAEK,QAAQ,CAACC,KAAK,CAAC;QAEnD,IAAI,CAACG,oBAAoB,CAACJ,QAAQ,CAACC,KAAK,CAAC;;IAI7C,CAAC,CAAC,CAEH;EAEH;EAEAI,MAAMA,CAAA;IAEJH,YAAY,CAACI,UAAU,CAAC,IAAI,CAACX,QAAQ,CAAC;IAEtC,IAAI,IAAI,CAACY,WAAW,EAAEC,YAAY,CAAC,IAAI,CAACD,WAAW,CAAC;IAEpD,IAAI,CAACd,MAAM,CAACgB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAElC;EAEAC,QAAQA,CAAA;IAEN,OAAOR,YAAY,CAACS,OAAO,CAAC,IAAI,CAAChB,QAAQ,CAAC;EAE5C;EAEAiB,UAAUA,CAAA;IAER,MAAMX,KAAK,GAAG,IAAI,CAACS,QAAQ,EAAE;IAE7B,IAAI,CAACT,KAAK,EAAE,OAAO,KAAK;IAExB,MAAMJ,OAAO,GAAG,IAAI,CAACgB,WAAW,CAACZ,KAAK,CAAC;IAEvC,IAAI,CAACJ,OAAO,EAAE,OAAO,KAAK;IAE1B,MAAMiB,MAAM,GAAGjB,OAAO,CAACkB,GAAG,GAAG,IAAI,CAAC,CAAC;IAEnC,OAAOC,IAAI,CAACC,GAAG,EAAE,GAAGH,MAAM;EAE5B;EAEQD,WAAWA,CAACZ,KAAa;IAE/B,IAAI;MAEF,OAAOiB,IAAI,CAACC,KAAK,CAACC,IAAI,CAACnB,KAAK,CAACoB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KAE7C,CAAC,OAAOC,CAAC,EAAE;MAEV,OAAO,IAAI;;EAIf;EAEA;EAEQlB,oBAAoBA,CAACH,KAAa;IAExC,MAAMJ,OAAO,GAAG,IAAI,CAACgB,WAAW,CAACZ,KAAK,CAAC;IAEvC,IAAI,CAACJ,OAAO,EAAE;IAEd,MAAMiB,MAAM,GAAGjB,OAAO,CAACkB,GAAG,GAAG,IAAI;IAEjC,MAAMQ,QAAQ,GAAGT,MAAM,GAAGE,IAAI,CAACC,GAAG,EAAE;IAEpC,IAAI,IAAI,CAACV,WAAW,EAAEC,YAAY,CAAC,IAAI,CAACD,WAAW,CAAC;IAEpD,IAAI,CAACA,WAAW,GAAGiB,UAAU,CAAC,MAAK;MAEjCC,KAAK,CAAC,uCAAuC,CAAC;MAE9C,IAAI,CAACpB,MAAM,EAAE;IAEf,CAAC,EAAEkB,QAAQ,CAAC;EAEd;;;uBApGWjC,WAAW,EAAAoC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;IAAA;EAAA;;;aAAXzC,WAAW;MAAA0C,OAAA,EAAX1C,WAAW,CAAA2C,IAAA;MAAAC,UAAA,EAJV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}